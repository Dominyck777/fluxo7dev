<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Cache do Navegador - Fluxo7 Dev</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #0d0d0d;
            color: #fff;
        }
        .container {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #ff6b00;
        }
        h1 {
            color: #ff6b00;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .status.success { background: rgba(40, 167, 69, 0.2); border: 1px solid #28a745; }
        .status.warning { background: rgba(255, 193, 7, 0.2); border: 1px solid #ffc107; color: #000; }
        .status.error { background: rgba(220, 53, 69, 0.2); border: 1px solid #dc3545; }
        
        button {
            background: #ff6b00;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
        }
        button:hover {
            background: #e55a00;
        }
        
        .data-box {
            background: #0d0d0d;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #333;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .found-data {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }
        
        .copy-btn {
            background: #28a745;
            padding: 5px 15px;
            font-size: 12px;
            margin: 5px;
            width: auto;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Verificar Cache do Navegador</h1>
        
        <div id="status" class="status warning">
            ‚è≥ Clique no bot√£o abaixo para verificar se h√° dados salvos no navegador...
        </div>
        
        <button onclick="checkBrowserCache()">üîç Verificar Cache Local</button>
        <button onclick="checkAllStorage()">üì± Verificar Todo o Storage</button>
        
        <div id="results"></div>
    </div>

    <script>
        function updateStatus(message, type = 'warning') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function addResult(title, data, found = false) {
            const resultsEl = document.getElementById('results');
            const div = document.createElement('div');
            
            div.innerHTML = `
                <h3>${title}</h3>
                <div class="data-box ${found ? 'found-data' : ''}">
                    ${data}
                </div>
                ${found ? `<button class="copy-btn" onclick="copyToClipboard('${title}', \`${data.replace(/`/g, '\\`')}\`)">üìã Copiar Dados</button>` : ''}
            `;
            
            resultsEl.appendChild(div);
        }
        
        function copyToClipboard(title, data) {
            navigator.clipboard.writeText(data).then(() => {
                alert(`‚úÖ Dados de "${title}" copiados para a √°rea de transfer√™ncia!`);
            }).catch(err => {
                console.error('Erro ao copiar:', err);
                alert('‚ùå Erro ao copiar dados');
            });
        }
        
        function checkBrowserCache() {
            updateStatus('üîç Verificando cache do navegador...', 'warning');
            
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '';
            
            let foundData = false;
            
            // Verificar chaves espec√≠ficas do Fluxo7 Dev
            const keysToCheck = [
                'preloaded_demands',
                'preloaded_transactions', 
                'preloaded_config',
                'fluxo7dev_db',
                'fluxo7dev_polling',
                'fluxo7dev_user'
            ];
            
            keysToCheck.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    foundData = true;
                    try {
                        const parsed = JSON.parse(data);
                        const formatted = JSON.stringify(parsed, null, 2);
                        addResult(`üéØ ${key}`, formatted, true);
                    } catch (e) {
                        addResult(`üéØ ${key}`, data, true);
                    }
                } else {
                    addResult(`‚ùå ${key}`, 'N√£o encontrado');
                }
            });
            
            if (foundData) {
                updateStatus('üéâ Dados encontrados no cache! Veja abaixo e copie os que precisar.', 'success');
            } else {
                updateStatus('üòû Nenhum dado espec√≠fico do Fluxo7 Dev encontrado no cache.', 'error');
            }
        }
        
        function checkAllStorage() {
            updateStatus('üì± Verificando todo o storage do navegador...', 'warning');
            
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '';
            
            let foundAny = false;
            
            // Verificar TODAS as chaves do localStorage
            addResult('üìä Total de chaves no localStorage', localStorage.length.toString());
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const data = localStorage.getItem(key);
                
                if (data && (
                    key.includes('fluxo') || 
                    key.includes('demand') || 
                    key.includes('transaction') || 
                    key.includes('preload') ||
                    data.includes('demands') ||
                    data.includes('transactions') ||
                    data.includes('devs') ||
                    data.includes('projects')
                )) {
                    foundAny = true;
                    try {
                        const parsed = JSON.parse(data);
                        const formatted = JSON.stringify(parsed, null, 2);
                        addResult(`üîç ${key}`, formatted, true);
                    } catch (e) {
                        addResult(`üîç ${key}`, data, true);
                    }
                }
            }
            
            // Verificar sessionStorage tamb√©m
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                const data = sessionStorage.getItem(key);
                
                if (data && (
                    key.includes('fluxo') || 
                    key.includes('demand') || 
                    key.includes('transaction') ||
                    data.includes('demands') ||
                    data.includes('transactions')
                )) {
                    foundAny = true;
                    try {
                        const parsed = JSON.parse(data);
                        const formatted = JSON.stringify(parsed, null, 2);
                        addResult(`üì± SessionStorage: ${key}`, formatted, true);
                    } catch (e) {
                        addResult(`üì± SessionStorage: ${key}`, data, true);
                    }
                }
            }
            
            if (foundAny) {
                updateStatus('üéâ Dados relacionados encontrados! Veja abaixo.', 'success');
            } else {
                updateStatus('üòû Nenhum dado relacionado encontrado no storage.', 'error');
                
                // Mostrar todas as chaves para debug
                const allKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    allKeys.push(localStorage.key(i));
                }
                addResult('üîç Todas as chaves do localStorage', allKeys.join('\n'));
            }
        }
        
        // Verificar automaticamente ao carregar
        window.onload = function() {
            setTimeout(checkBrowserCache, 1000);
        };
    </script>
</body>
</html>
